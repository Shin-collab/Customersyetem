<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC | GSB Portal - Customer Management System</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <style>
        /* =========================================
           1. ROOT & THEME VARIABLES
           ========================================= */
        :root { 
            --primary: #eb008b; 
            --primary-hover: #c40076;
            --primary-light: rgba(235, 0, 139, 0.1);
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-label: #334155;
            --border-color: #cbd5e1;
            --input-bg: #ffffff;
            --input-focus: #ffffff;
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --glass: rgba(255, 255, 255, 0.8);
        }
        
        [data-theme="dark"] { 
            --bg-body: #020617; 
            --bg-card: #111827; 
            --text-main: #f8fafc; 
            --text-label: #cbd5e1;
            --border-color: #374151; 
            --input-bg: #1f2937;
            --input-focus: #0f172a;
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --glass: rgba(31, 41, 55, 0.7);
        }

        /* =========================================
           2. GLOBAL STYLES
           ========================================= */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Sarabun', sans-serif; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        body { 
            background-color: var(--bg-body);
            background-image: 
                radial-gradient(at 0% 0%, rgba(235, 0, 139, 0.08) 0px, transparent 45%),
                radial-gradient(at 100% 100%, rgba(235, 0, 139, 0.05) 0px, transparent 45%);
            color: var(--text-main); 
            padding: 50px 15px; 
            line-height: 1.6;
            min-height: 100vh;
        }

        /* =========================================
           3. CARD & LAYOUT
           ========================================= */
        .card { 
            background: var(--bg-card); 
            max-width: 800px; 
            margin: auto; 
            border-radius: 28px; 
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg); 
            padding: 45px; 
            position: relative;
            z-index: 10;
        }

        .card::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, var(--primary), #ff69b4);
            border-radius: 28px 28px 0 0;
        }

        .h-title { 
            font-size: 2rem; 
            font-weight: 800; 
            color: var(--primary); 
            text-align: center; 
            margin-bottom: 35px; 
            letter-spacing: -0.5px;
            text-transform: uppercase;
        }
        
        /* =========================================
           4. FORM ELEMENTS
           ========================================= */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 22px; 
            margin-bottom: 22px; 
        }
        
        .full { grid-column: span 2; }
        
        label { 
            font-weight: 600; 
            font-size: 0.92rem; 
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px; 
            color: var(--text-label); 
        }

        label i { color: var(--primary); font-size: 0.85rem; }
        
        input, select { 
            width: 100%; 
            padding: 13px 16px; 
            border: 2px solid var(--border-color); 
            border-radius: 14px; 
            background: var(--input-bg); 
            color: var(--text-main); 
            outline: none; 
            font-size: 0.98rem;
        }
        
        input:focus, select:focus { 
            border-color: var(--primary); 
            background: var(--input-focus);
            box-shadow: 0 0 0 4px var(--primary-light); 
        }

        /* =========================================
           5. DYNAMIC EDUCATION BOX (The Logic Part)
           ========================================= */
        #eduBox { 
            display: none; 
            background: var(--glass); 
            padding: 25px; 
            border-radius: 20px; 
            border: 2px dashed var(--primary); 
            grid-column: span 2; 
            margin: 10px 0;
            animation: slideInDown 0.4s ease-out;
        }

        #majorRow {
            display: block; /* Default visible inside eduBox */
        }
        
        /* =========================================
           6. BUTTONS & UI COMPONENTS
           ========================================= */
        .btn-row { 
            display: flex; 
            gap: 15px; 
            margin-top: 35px; 
        }
        
        .btn { 
            flex: 1; 
            padding: 16px; 
            border-radius: 14px; 
            font-weight: 700; 
            border: none; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            font-size: 1.05rem; 
            transition: all 0.2s;
        }
        
        .btn-sv { 
            background: var(--primary); 
            color: #ffffff !important; 
            box-shadow: 0 10px 15px -3px rgba(235, 0, 139, 0.3); 
        }
        
        .btn-cc { 
            background: #64748b; 
            color: #ffffff !important; 
        }
        
        .btn:hover { 
            transform: translateY(-2px); 
            filter: brightness(1.1); 
            box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.2);
        }

        .theme-btn { 
            position: fixed; 
            top: 25px; 
            right: 25px; 
            cursor: pointer; 
            background: var(--bg-card); 
            width: 50px; 
            height: 50px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-radius: 50%; 
            border: 1px solid var(--border-color);
            color: var(--primary);
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* =========================================
           7. RESPONSIVE DESIGN
           ========================================= */
        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; gap: 18px; }
            .full { grid-column: span 1; }
            .card { padding: 30px 20px; }
            .h-title { font-size: 1.6rem; }
        }
    </style>
</head>
<body>

<div class="theme-btn" onclick="toggleTheme()" title="สลับโหมด">
    <i class="fa-solid fa-moon"></i>
</div>

<div class="card animate__animated animate__fadeIn">
    <div class="h-title">บันทึกข้อมูลลูกค้า (KYC)</div>
    
    <form th:action="@{/customers/save}" th:object="${customer}" method="post" id="kycForm">
        <input type="hidden" th:field="*{id}">
        
        <div class="grid">
            <div class="full">
                <label><i class="fa-solid fa-user-tag"></i> ชื่อ-นามสกุล (ภาษาไทย)</label>
                <input type="text" th:field="*{name}" required id="nm" 
                       placeholder="กรอกชื่อและนามสกุล" 
                       oninput="this.value=this.value.replace(/[0-9]/g,'')">
            </div>
            
            <div>
                <label><i class="fa-solid fa-face-smile"></i> ชื่อเล่น</label>
                <input type="text" th:field="*{nickname}" placeholder="ระบุชื่อเล่น">
            </div>
            
            <div>
                <label><i class="fa-solid fa-calendar"></i> วัน/เดือน/ปีเกิด</label>
                <input type="date" th:field="*{birthDate}" required>
            </div>
            
            <div class="full">
                <label><i class="fa-solid fa-map-pin"></i> ที่อยู่ปัจจุบัน</label>
                <input type="text" th:field="*{houseNo}" placeholder="เลขที่บ้าน, หมู่บ้าน, ถนน, ตำบล">
            </div>
            
            <div>
                <label><i class="fa-solid fa-city"></i> จังหวัด</label>
                <input type="text" th:field="*{province}" placeholder="ระบุจังหวัด">
            </div>
            
            <div>
                <label><i class="fa-solid fa-user-tie"></i> อาชีพปัจจุบัน</label>
                <select th:field="*{occupation}" id="occ" onchange="handleUIUpdate()">
                    <option value="พนักงานบริษัท">พนักงานบริษัท</option>
                    <option value="ธุรกิจส่วนตัว">ธุรกิจส่วนตัว/ค้าขาย</option>
                    <option value="ข้าราชการ">ข้าราชการ/รัฐวิสาหกิจ</option>
                    <option value="กำลังศึกษา">นักเรียน/นักศึกษา</option>
                    <option value="รับจ้างทั่วไป">รับจ้างทั่วไป</option>
                    <option value="อื่นๆ">อื่นๆ</option>
                </select>
            </div>
            
            <div id="eduBox">
                <div class="grid" style="margin:0;">
                    <div>
                        <label><i class="fa-solid fa-graduation-cap"></i> ระดับการศึกษา</label>
                        <select th:field="*{education}" id="eduSelect" onchange="handleUIUpdate()">
                            <option value="">-- ระบุระดับ --</option>
                            <option value="อนุบาล">อนุบาล</option>
                            <option value="ประถมศึกษา">ประถมศึกษา</option>
                            <option value="มัธยมศึกษาตอนต้น">มัธยมศึกษาตอนต้น (ม.1-3)</option>
                            <option value="มัธยมศึกษาตอนปลาย">มัธยมศึกษาตอนปลาย (ม.4-6)</option>
                            <option value="ปวช.">ปวช.</option>
                            <option value="ปวส.">ปวส.</option>
                            <option value="ปริญญาตรี">ปริญญาตรี</option>
                            <option value="สูงกว่าปริญญาตรี">สูงกว่าปริญญาตรี</option>
                        </select>
                    </div>
                    <div>
                        <label><i class="fa-solid fa-list-ol"></i> ชั้นปี/ระดับชั้น</label>
                        <input type="text" th:field="*{educationYear}" placeholder="เช่น ม.6 หรือ ปี 4">
                    </div>
                    
                    <div class="full" id="majorRow">
                        <label id="majorLabel"><i class="fa-solid fa-book"></i> คณะ / สาขาวิชา</label>
                        <input type="text" th:field="*{major}" id="majorInput" placeholder="ระบุสายการเรียน">
                    </div>
                </div>
            </div>
            
            <div class="full">
                <label><i class="fa-solid fa-building-columns"></i> สถานที่ทำงาน / ชื่อสถาบัน</label>
                <input type="text" th:field="*{workPlace}" placeholder="ระบุชื่อหน่วยงาน">
            </div>
            
            <div>
                <label><i class="fa-solid fa-briefcase-medical"></i> โรคประจำตัว</label>
                <input type="text" th:field="*{disease}" placeholder="-">
            </div>
            
            <div>
                <label><i class="fa-solid fa-hand-dots"></i> ประวัติการแพ้</label>
                <input type="text" th:field="*{allergy}" placeholder="-">
            </div>
        </div>

        <div class="btn-row">
            <a th:href="@{/}" class="btn btn-cc">ยกเลิก</a>
            <button type="submit" class="btn btn-sv">
                <i class="fa-solid fa-floppy-disk"></i> บันทึกข้อมูลลูกค้า
            </button>
        </div>
    </form>
</div>

<script>
    // ระบบจัดการ Theme
    const toggleTheme = () => {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('gsb-theme', next);
        updateThemeIcon(next);
    };
    
    const updateThemeIcon = (theme) => {
        const icon = document.querySelector('.theme-btn i');
        icon.className = theme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
    };

    // โหลดค่าเริ่มต้น
    const savedTheme = localStorage.getItem('gsb-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);

    // ฟังก์ชันหลัก: ควบคุม UI ทั้งหมด (อาชีพ & การศึกษา)
    function handleUIUpdate() { 
        const occupation = document.getElementById('occ').value;
        const eduBox = document.getElementById('eduBox');
        const education = document.getElementById('eduSelect').value;
        const majorRow = document.getElementById('majorRow');
        const majorLabel = document.getElementById('majorLabel');
        const majorInput = document.getElementById('majorInput');

        // 1. ตรวจสอบอาชีพ "กำลังศึกษา"
        if (occupation === 'กำลังศึกษา') {
            eduBox.style.display = 'block';
            
            // 2. ตรวจสอบระดับการศึกษา (ซ่อน/แสดง คณะ)
            // ระดับภาคบังคับ/เด็กเล็ก: อนุบาล, ประถม, ม.ต้น -> ไม่ต้องมีคณะ
            const basicLevels = ['อนุบาล', 'ประถมศึกษา', 'มัธยมศึกษาตอนต้น'];
            
            if (basicLevels.includes(education) || education === '') {
                majorRow.style.display = 'none';
                majorInput.value = ''; // เคลียร์ค่าทิ้ง
            } else {
                majorRow.style.display = 'block';
                
                // 3. เปลี่ยน Label ตามประเภท (ปวช./ปวส./ม.ปลาย/ป.ตรี)
                if (education === 'มัธยมศึกษาตอนปลาย') {
                    majorLabel.innerHTML = '<i class="fa-solid fa-book"></i> แผนการเรียน (เช่น วิทย์-คณิต)';
                    majorInput.placeholder = 'ระบุแผนการเรียน';
                } else if (education === 'ปวช.' || education === 'ปวส.') {
                    majorLabel.innerHTML = '<i class="fa-solid fa-wrench"></i> สาขาวิชา / แผนกวิชา';
                    majorInput.placeholder = 'เช่น ช่างยนต์, บัญชี, คอมพิวเตอร์';
                } else {
                    majorLabel.innerHTML = '<i class="fa-solid fa-university"></i> คณะ / สาขาวิชา';
                    majorInput.placeholder = 'ระบุคณะและสาขา';
                }
            }
        } else {
            eduBox.style.display = 'none';
        }
    }

    // Validation ก่อนส่งฟอร์ม
    document.getElementById('kycForm').onsubmit = function() {
        const name = document.getElementById('nm').value;
        if (/[\d]/.test(name)) {
            alert('❌ กรุณากรอกชื่อ-นามสกุล เป็นตัวอักษรเท่านั้น');
            return false;
        }
        return true;
    };

    // รันฟังก์ชันเมื่อโหลดหน้าเสร็จ
    window.onload = handleUIUpdate;
</script>
</body>
</html>